<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DaaS 資料品質管理 v71</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="app-container">
        <header class="app-header">
            <div class="flex items-center gap-3">
                <div class="logo-box">DaaS</div>
                <span class="text-lg font-bold text-gray-800 tracking-tight">數據品質管理平台</span>
            </div>
            <div class="flex items-center gap-4">
                <div class="user-avatar">PM</div>
            </div>
        </header>

        <div class="main-area">
            
            <div class="filter-section">
                <div class="flex justify-between items-center cursor-pointer mb-6" onclick="toggleFilterPanel()">
                    <h2 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                        <i class="fas fa-search text-blue-600"></i> 搜尋條件
                    </h2>
                    <div class="flex items-center gap-3">
                        <button class="btn-primary" onclick="event.stopPropagation(); executeSearch();">
                            搜尋
                        </button>
                        <i class="fas fa-chevron-up text-gray-500 transform transition-transform" id="filter-panel-icon"></i>
                    </div>
                </div>

                <div id="filter-panel-content" class="block">
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-gray-700 mb-2">關鍵字搜尋</label>
                        <input type="text" placeholder="輸入資料表名稱、欄位名稱..." class="input-field">
                    </div>

                    <div class="flex flex-col gap-0">
                        <div class="accordion-item w-full">
                            <div class="accordion-header" onclick="toggleAccordion(this)">
                                <span>數據主題 (Data Domain)</span><i class="fas fa-chevron-down accordion-icon text-gray-400"></i>
                            </div>
                            <div class="accordion-content">
                                <div class="flex flex-wrap gap-4 text-sm">
                                    <label class="checkbox-label"><input type="checkbox" class="mr-2">客戶主題</label>
                                    <label class="checkbox-label"><input type="checkbox" class="mr-2">銷售主題</label>
                                    <label class="checkbox-label"><input type="checkbox" class="mr-2">財務主題</label>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item w-full">
                            <div class="accordion-header" onclick="toggleAccordion(this)">
                                <span>資料類別 (Data Class)</span><i class="fas fa-chevron-down accordion-icon text-gray-400"></i>
                            </div>
                            <div class="accordion-content">
                                <div class="flex flex-wrap gap-4 text-sm">
                                    <label class="checkbox-label"><input type="checkbox" class="mr-2">ID</label>
                                    <label class="checkbox-label"><input type="checkbox" class="mr-2">Code</label>
                                    <label class="checkbox-label"><input type="checkbox" class="mr-2">Date</label>
                                    <label class="checkbox-label"><input type="checkbox" class="mr-2">Amount</label>
                                    <label class="checkbox-label"><input type="checkbox" class="mr-2">Text</label>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item w-full">
                            <div class="accordion-header" onclick="toggleAccordion(this)">
                                <span>敏感性標記 (Sensitive Mark)</span><i class="fas fa-chevron-down accordion-icon text-gray-400"></i>
                            </div>
                            <div class="accordion-content">
                                <div class="flex flex-wrap gap-4 text-sm">
                                    <label class="checkbox-label"><input type="checkbox" class="mr-2">PII (個資)</label>
                                    <label class="checkbox-label"><input type="checkbox" class="mr-2">Financial</label>
                                    <label class="checkbox-label"><input type="checkbox" class="mr-2">Confidential</label>
                                    <label class="checkbox-label"><input type="checkbox" class="mr-2">None</label>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item w-full">
                            <div class="accordion-header" onclick="toggleAccordion(this)">
                                <span>任務狀態篩選</span><i class="fas fa-chevron-down accordion-icon text-gray-400"></i>
                            </div>
                            <div class="accordion-content">
                                <div class="flex flex-col gap-3 text-sm">
                                    <div class="flex gap-6">
                                        <label class="checkbox-label text-blue-700 font-medium"><input type="checkbox" class="mr-2">有配置任務</label>
                                        <label class="checkbox-label text-red-600"><input type="checkbox" class="mr-2">未配置任務</label>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <label class="text-gray-500 whitespace-nowrap w-24">特定任務:</label>
                                        <select class="filter-select">
                                            <option value="">-- 全部 --</option>
                                            <option>Daily DQ Check</option>
                                            <option>Monthly Report</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item w-full">
                            <div class="accordion-header" onclick="toggleAccordion(this)">
                                <span>規則狀態篩選</span><i class="fas fa-chevron-down accordion-icon text-gray-400"></i>
                            </div>
                            <div class="accordion-content">
                                <div class="flex flex-col gap-3 text-sm">
                                    <div class="flex gap-6">
                                        <label class="checkbox-label text-blue-700 font-medium"><input type="checkbox" class="mr-2">有配置規則</label>
                                        <label class="checkbox-label text-red-600"><input type="checkbox" class="mr-2">未配置規則</label>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <label class="text-gray-500 whitespace-nowrap w-24">特定規則:</label>
                                        <select class="filter-select">
                                            <option value="">-- 全部 --</option>
                                            <option>資料完備性</option>
                                            <option>資料一致性</option>
                                            <option>資料準確性</option>
                                            <option>資料健全性</option>
                                            <option>資料獨特性</option>
                                            <option>資料規範</option>
                                            <option>自訂 SQL</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="empty-state" class="empty-state">
                <i class="fas fa-search text-6xl mb-4 text-gray-200"></i>
                <p class="text-lg font-medium">請輸入條件並點擊「搜尋」以檢視資產列表</p>
            </div>

            <div id="results-area" class="results-container hidden animate-fade-in">
                <div class="results-header">
                    <h3 class="font-bold text-gray-800 text-lg">搜尋結果 <span class="text-sm font-normal text-gray-500 ml-2 bg-gray-100 px-3 py-1 rounded-full">共 <span id="total-count">0</span> 欄位</span></h3>
                    <button id="btn-apply-rules" class="btn-secondary flex items-center" disabled onclick="openWizard()">
                        <i class="fas fa-magic mr-2"></i>套用規則 (<span id="selected-count">0</span>)
                    </button>
                </div>

                <div class="table-wrapper">
                    <table>
                        <colgroup>
                            <col style="width: 60px;">  <col style="width: 250px;"> <col style="width: 120px;"> <col style="width: 100px;"> <col style="width: 100px;"> <col style="width: 280px;"> <col style="width: 120px;"> <col style="width: 160px;"> <col style="width: 140px;"> <col style="width: 160px;"> <col style="width: 120px;"> <col style="width: 140px;"> <col style="width: 140px;"> </colgroup>
                        <thead>
                            <tr>
                                <th class="text-center no-sort sticky-col-1"><input type="checkbox" id="check-all" class="rounded text-blue-600 w-4 h-4"></th>
                                <th class="sticky-col-2" onclick="sortTable('name')">欄位名稱 <i class="fas fa-sort sort-icon"></i></th>
                                <th onclick="sortTable('type')">Type <i class="fas fa-sort sort-icon"></i></th>
                                <th onclick="sortTable('class')">Class <i class="fas fa-sort sort-icon"></i></th>
                                <th onclick="sortTable('sensitive')">敏感性 <i class="fas fa-sort sort-icon"></i></th>
                                <th class="border-l border-gray-200 no-sort">規則名稱</th>
                                <th class="text-center no-sort">Base Line</th>
                                <th class="text-center bg-blue-50 text-blue-800 no-sort">通過標準</th>
                                <th class="text-center border-l border-gray-200" onclick="sortTable('status')">剖析狀態 <i class="fas fa-sort sort-icon"></i></th>
                                <th class="text-right no-sort">掃描筆數</th>
                                <th class="text-center" onclick="sortTable('task')">所屬任務 <i class="fas fa-sort sort-icon"></i></th>
                                <th class="text-center border-l border-gray-200" onclick="sortTable('ruleTime')">規則更新時間 <i class="fas fa-sort sort-icon"></i></th>
                                <th class="text-center" onclick="sortTable('profileTime')">剖析更新時間 <i class="fas fa-sort sort-icon"></i></th>
                            </tr>
                        </thead>
                        <tbody id="table-body">
                            </tbody>
                    </table>
                </div>

                <div class="pagination-bar">
                    <div class="text-gray-600">顯示 1 到 10 筆，共 <span id="pag-total">0</span> 筆</div>
                    <div class="flex gap-2">
                        <button class="btn-page" disabled>上一頁</button>
                        <button class="btn-page active">1</button>
                        <button class="btn-page">2</button>
                        <span class="px-2 py-1 text-gray-400">...</span>
                        <button class="btn-page">下一頁</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="wizard-modal" class="modal-overlay">
        <div class="modal-box w-full max-w-5xl h-[85vh]">
            <div class="modal-header">
                <h3 class="text-xl font-bold">套用規則精靈</h3>
                <button onclick="closeWizard()" class="close-btn"><i class="fas fa-times"></i></button>
            </div>
            <div class="px-10 py-6">
                <div class="flex items-center justify-between relative">
                    <div class="flex flex-col items-center step-item step-active" data-step="1"><div class="step-indicator">1</div><span class="text-xs mt-1 font-bold">規則參數</span></div>
                    <div class="step-line"></div>
                    <div class="flex flex-col items-center step-item step-pending" data-step="2"><div class="step-indicator">2</div><span class="text-xs mt-1 font-bold">執行設定</span></div>
                </div>
            </div>
            <div class="modal-body bg-gray-50">
                <div id="step-1" class="wizard-step">
                    <h4 class="text-lg font-bold mb-4">Step 1: 選擇規則並設定參數</h4>
                    <div id="rules-list-container" class="space-y-4"></div>
                </div>
                <div id="step-2" class="wizard-step hidden">
                    <h4 class="text-lg font-bold mb-4">Step 2: 執行設定</h4>
                    <div class="bg-blue-50 p-6 rounded border border-blue-200 mb-8">
                        <div class="grid grid-cols-2 gap-6">
                            <div>
                                <label class="block text-xs font-bold mb-1">執行範圍 (Scope)</label>
                                <div class="flex gap-2">
                                    <select id="w-scope" class="input-field w-1/2"><option value="full">全量檢查</option><option value="percent">抽樣 %</option><option value="rows">抽樣 Rows</option></select>
                                    <input type="number" id="w-scope-val" class="input-field w-1/2 hidden" placeholder="數值">
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-bold mb-1">資料過濾 (Where)</label>
                                <input type="text" id="w-where" class="input-field w-full" placeholder="STATUS='A'">
                            </div>
                        </div>
                    </div>
                    <div class="text-center py-8 text-gray-600">
                        <p class="mb-2">已選取 <span id="summary-rule-count" class="font-bold text-blue-600">0</span> 條規則</p>
                        <p class="text-sm">點擊執行後，系統將於背景進行掃描，完成後請設定標準。</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-wiz-prev" class="btn-white" disabled>上一步</button>
                <div class="flex gap-2">
                    <button onclick="closeWizard()" class="btn-text">取消</button>
                    <button id="btn-wiz-next" class="btn-blue">下一步</button>
                    <button id="btn-wiz-run" class="btn-green hidden">執行資料剖析</button>
                </div>
            </div>
        </div>
    </div>

    <div id="criteria-modal" class="modal-overlay">
        <div class="modal-box w-96 h-auto">
            <div class="modal-header"><h3 class="font-bold text-lg">品質標準設定</h3></div>
            <div class="modal-body space-y-4">
                <div class="bg-gray-50 p-2 rounded text-sm text-gray-600">設定 <span id="crit-rule-name" class="font-bold text-blue-600"></span> 的通過標準</div>
                <div><label class="label-sm">基準線 (Base Line)</label><input id="crit-base" class="input-readonly font-mono font-bold" readonly></div>
                <div><label class="label-sm">容忍值 (Tolerance)</label><div class="flex items-center"><input type="number" id="crit-tol" value="0" class="input-field text-center font-bold"><span class="ml-2 font-bold text-sm">%</span></div></div>
                <div><label class="label-sm text-blue-700">通過標準 (Criteria)</label><input id="crit-val" class="input-readonly bg-blue-50 text-blue-700 font-bold" readonly></div>
            </div>
            <div class="modal-footer justify-end">
                <button onclick="document.getElementById('criteria-modal').classList.remove('open')" class="btn-white">取消</button>
                <button onclick="saveCriteria()" class="btn-blue">儲存設定</button>
            </div>
        </div>
    </div>

    <div id="detail-modal" class="modal-overlay">
        <div class="modal-box w-[500px] h-auto">
            <div class="modal-header">
                <h3 class="font-bold text-lg">規則詳情</h3>
                <span id="badge-edit" class="hidden text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded border border-yellow-200 font-bold">編輯模式</span>
            </div>
            <div class="modal-body">
                <div id="view-mode-content" class="text-sm text-gray-600 space-y-2"></div>
                <div id="edit-mode-content" class="hidden flex flex-col gap-4">
                    <div id="edit-inputs" class="bg-gray-50 p-4 rounded border border-gray-200"></div>
                    <div class="text-xs text-red-500"><i class="fas fa-exclamation-triangle mr-1"></i> 修改參數將強制重跑</div>
                    <button id="btn-rerun" class="btn-purple w-full" onclick="executeInEditMode()"><i class="fas fa-sync-alt mr-1"></i> 執行重算 (背景)</button>
                    <div id="post-run-area" class="hidden bg-blue-50 p-3 rounded border border-blue-200">
                        <div class="grid grid-cols-3 gap-2">
                            <div><label class="label-sm">新基準</label><input id="e-base" class="input-readonly px-1" readonly></div>
                            <div><label class="label-sm">容忍值</label><input id="e-tol" type="number" class="input-field px-1 text-center"></div>
                            <div><label class="label-sm text-blue-700">新標準</label><input id="e-crit" class="input-readonly bg-blue-100 px-1 text-blue-700" readonly></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-between">
                <button id="btn-del" class="text-red-500 hover:bg-red-50 px-3 py-2 rounded text-sm hidden" onclick="deleteRule()">移除規則</button>
                <div class="flex gap-2 ml-auto">
                    <button id="btn-close" onclick="closeDetailModal()" class="btn-white">關閉</button>
                    <button id="btn-edit" onclick="enableEdit()" class="btn-blue">編輯參數</button>
                    <button id="btn-save" onclick="saveEditAndRun()" class="hidden btn-purple font-bold">儲存設定</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>